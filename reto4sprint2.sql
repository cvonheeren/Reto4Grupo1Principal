
/**************************************************************************
* BORRA LAS TABLAS SI YA EXISTEN
***************************************************************************/

DROP TABLE IF EXISTS RESERVA_DORMITORIO;
DROP TABLE IF EXISTS ALOJAMIENTO_DORMITORIO;
DROP TABLE IF EXISTS RESERVAS;
DROP TABLE IF EXISTS DORMITORIOS;
DROP TABLE IF EXISTS CLIENTES;
DROP TABLE IF EXISTS ALOJAMIENTOS;
DROP TABLE IF EXISTS UBICACIONES;


/**************************************************************************
* CREA LAS TABLAS
***************************************************************************/

CREATE TABLE UBICACIONES
(
COD_UBICACION INT(3) AUTO_INCREMENT PRIMARY KEY,
NOMBRE VARCHAR(50) NOT NULL CHECK (NOMBRE = UPPER(NOMBRE)),
COD_POSTAL VARCHAR(5) NOT NULL,
PAIS VARCHAR(50) NOT NULL CHECK (PAIS = UPPER(PAIS))
);

CREATE TABLE ALOJAMIENTOS
(
COD_ALOJAMIENTO INT(6) AUTO_INCREMENT PRIMARY KEY,
COD_UBICACION INT(3),
NOMBRE VARCHAR(50) NOT NULL CHECK (NOMBRE = UPPER(NOMBRE)),
DESCRIPCION VARCHAR(500),
LONGITUD FLOAT(6),
LATITUD FLOAT(6),
TIPO CHAR NOT NULL CHECK (TIPO IN('H', 'C', 'A')),
ESTRELLAS INT(1) CHECK (ESTRELLAS BETWEEN 1 AND 5),
ALTURA INT(2),
TARIFA_NORMAL FLOAT(6) NOT NULL,
TARIFA_VERANO FLOAT(6),
REGARGO FLOAT(6) DEFAULT 0,
DESAYUNO FLOAT(6) DEFAULT 0,
MEDIA_PENSION FLOAT(6) DEFAULT 0,
PENSION_COMPLETA FLOAT(6) DEFAULT 0,
IMGURL VARCHAR(100) DEFAULT 'https://stampedtribe.com/wp-content/uploads/2018/03/hotel-icon-10.png',
FOREIGN KEY (COD_UBICACION) REFERENCES UBICACIONES (COD_UBICACION) ON DELETE CASCADE
);

CREATE TABLE CLIENTES
(
COD_CLIENTE INT(6) AUTO_INCREMENT PRIMARY KEY,
DNI VARCHAR(9) UNIQUE NOT NULL CHECK (DNI = UPPER(DNI)),
CONTRASENA VARCHAR(33) NOT NULL,
NOMBRE VARCHAR(50),
APELLIDOS VARCHAR(50),
FECHANAC DATE,
EMAIL VARCHAR(50)
);

CREATE TABLE DORMITORIOS
(
COD_DORMITORIO INT(6) AUTO_INCREMENT PRIMARY KEY,
NOMBRE VARCHAR(50) NOT NULL,
CTD_CAMAS_SIMPLES INT(3),
CTD_CAMAS_MATRIMONIO INT(2),
CTD_CAMAS_INFANTIL INT(2),
TAMANO FLOAT(4) NOT NULL
);

CREATE TABLE RESERVAS
(
COD_RESERVA INT(6) AUTO_INCREMENT PRIMARY KEY,
COD_CLIENTE INT(6),
COD_ALOJAMIENTO INT(6),
FECHACOMPRA DATETIME NOT NULL,
FECHAENTRADA DATE NOT NULL,
FECHASALIDA DATE NOT NULL,
PRECIOTOTAL FLOAT(6) NOT NULL,
FOREIGN KEY (COD_CLIENTE) REFERENCES CLIENTES (COD_CLIENTE) ON DELETE CASCADE,
FOREIGN KEY (COD_ALOJAMIENTO) REFERENCES ALOJAMIENTOS (COD_ALOJAMIENTO) ON DELETE CASCADE
);

CREATE TABLE ALOJAMIENTO_DORMITORIO
(
COD_ALOJAMIENTO INT(6),
COD_DORMITORIO INT(6),
CANTIDAD INT(3) NOT NULL,
FOREIGN KEY (COD_ALOJAMIENTO) REFERENCES ALOJAMIENTOS (COD_ALOJAMIENTO) ON DELETE CASCADE,
FOREIGN KEY (COD_DORMITORIO) REFERENCES DORMITORIOS (COD_DORMITORIO) ON DELETE CASCADE
);

CREATE TABLE RESERVA_DORMITORIO
(
COD_RESERVA INT(6),
COD_DORMITORIO INT(6),
CANTIDAD INT(3) NOT NULL,
FOREIGN KEY (COD_RESERVA) REFERENCES RESERVAS (COD_RESERVA) ON DELETE CASCADE,
FOREIGN KEY (COD_DORMITORIO) REFERENCES DORMITORIOS (COD_DORMITORIO) ON DELETE CASCADE
);


/**************************************************************************
* INSERTA LOS DATOS
***************************************************************************/

-- DECLARACION DE VARIABLES --

SET @DESC := 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris purus nulla, consectetur id elit id, suscipit dictum mauris. Cras est magna, hendrerit eu fringilla ut, feugiat sed lorem. Sed sit amet placerat sapien, at sodales ligula. Proin semper nisl in nibh molestie mattis at at augue. Aenean ac facilisis ante. Fusce in elementum dolor. Aenean luctus blandit mi, et rutrum tortor placerat vel. Praesent dictum aliquam lectus, in viverra risus. Cras vehicula turpis eu metus faucibus, in mattis neque condimentum. Mauris maximus viverra est, sit amet viverra purus condimentum at.';


-- TABLA UBICACIONES --

INSERT INTO UBICACIONES VALUES (NULL, 'BARCELONA', '08001', 'ESPAÑA');
INSERT INTO UBICACIONES VALUES (NULL, 'BILBAO', '48001', 'ESPAÑA');
INSERT INTO UBICACIONES VALUES (NULL, 'MADRID', '28001', 'ESPAÑA');
INSERT INTO UBICACIONES VALUES (NULL, 'MALAGA', '29001', 'ESPAÑA');
INSERT INTO UBICACIONES VALUES (NULL, 'VALENCIA', '46001', 'ESPAÑA');
INSERT INTO UBICACIONES VALUES (NULL, 'ZARAGOZA', '50001', 'ESPAÑA');
INSERT INTO UBICACIONES VALUES (NULL, 'AMSTERDAM', '50001', 'HOLANDA');
INSERT INTO UBICACIONES VALUES (NULL, 'BERLIN', '50001', 'ALEMANIA');
INSERT INTO UBICACIONES VALUES (NULL, 'LONDRES', '50001', 'REINO UNIDO');
INSERT INTO UBICACIONES VALUES (NULL, 'PARIS', '50001', 'FRANCIA');
INSERT INTO UBICACIONES VALUES (NULL, 'ROMA', '50001', 'ITALIA');


-- TABLA ALOJAMIENTOS --

INSERT INTO ALOJAMIENTOS VALUES (NULL, 1, 'CATALONIA SAGRADA FAMILIA', @DESC, 41.4077823, 2.1853613, 'H', 3, NULL, 49.90, 60, 5, 0, 10, 15, 'https://media-cdn.tripadvisor.com/media/photo-s/0f/ee/90/f2/hotel-catalonia-sagrada.jpg');
INSERT INTO ALOJAMIENTOS VALUES (NULL, 1, 'ROYAL RAMBLAS', @DESC, 41.3843398, 2.1704865, 'H', 4, NULL, 59.99, 75.99, 10, 5, 15, 25, default);
INSERT INTO ALOJAMIENTOS VALUES (NULL, 1, 'BARCELONA PRINCESS', @DESC, 41.4109621, 2.218664, 'H', 4, NULL, 59.99, 75.99, 10, 5, 15, 25, default);
INSERT INTO ALOJAMIENTOS VALUES (NULL, 2, 'ERCILLA HOTEL', @DESC, 43.2610987, -2.9386205, 'H', 4, NULL, 59.99, 75.99, 10, 5, 15, 25, default);
INSERT INTO ALOJAMIENTOS VALUES (NULL, 2, 'GRAN HOTEL DOMINE BILBAO', @DESC, 43.267156, -2.933837, 'H', 4, NULL, 59.99, 75.99, 10, 5, 15, 25, default);
INSERT INTO ALOJAMIENTOS VALUES (NULL, 3, 'EXE PLAZA', @DESC, 40.4675402, -3.690392, 'H', 4, NULL, 59.99, 75.99, 10, 5, 15, 25, default);
INSERT INTO ALOJAMIENTOS VALUES (NULL, 3, 'AYRE GRAN HOTEL COLON', @DESC, 40.413003, -3.669204, 'H', 4, NULL, 59.99, 75.99, 10, 5, 15, 25, default);
INSERT INTO ALOJAMIENTOS VALUES (NULL, 3, 'TOTEM MADRID', @DESC, 40.4264885, -3.6855333, 'H', 4, NULL, 59.99, 75.99, 10, 5, 15, 25, default);
INSERT INTO ALOJAMIENTOS VALUES (NULL, 4, 'SOHO BAHIA MALAGA', @DESC, 36.7155267, -4.4235837, 'H', 4, NULL, 59.99, 75.99, 10, 5, 15, 25, default);
INSERT INTO ALOJAMIENTOS VALUES (NULL, 4, 'HOTEL GUADALMEDINA', @DESC, 36.715032, -4.426636, 'H', 4, NULL, 59.99, 75.99, 10, 5, 15, 25, default);


-- TABLA CLIENTES --

INSERT INTO CLIENTES VALUES (NULL, '83178234E', MD5('1234'), 'NURIA', 'RUIZ RAMOS', '24-02-1984', 'nuria.ruiz@gmail.com');
INSERT INTO CLIENTES VALUES (NULL, '01820557S', MD5('1234'), 'ALBERTO', 'ASENSIO GARCIA', '01-05-1976', 'alberto.asensio@gmail.com');
INSERT INTO CLIENTES VALUES (NULL, '12345678A', MD5('1234'), 'PRUEBAS', 'AAAAA', '01-05-1976', 'testeo@gmail.com');

-- TABLA DORMITORIOS --

INSERT INTO DORMITORIOS VALUES (NULL, 'HABITACION DOBLE ESTANDAR', 2, 0, 0, 25.8);
INSERT INTO DORMITORIOS VALUES (NULL, 'HABITACION DOBLE MATRIMONIO', 0, 1, 0, 30);
INSERT INTO DORMITORIOS VALUES (NULL, 'HABITACION TRIPLE ESTANDAR', 3, 0, 0, 30.5);
INSERT INTO DORMITORIOS VALUES (NULL, 'HABITACION FAMILIAR 1 NINO', 0, 1, 1, 31.6);
INSERT INTO DORMITORIOS VALUES (NULL, 'HABITACION FAMILIAR 2 NINOS', 0, 1, 2, 38.5);
INSERT INTO DORMITORIOS VALUES (NULL, 'HABITACION FAMILIAR 3 NINOS', 0, 1, 3, 45.5);
INSERT INTO DORMITORIOS VALUES (NULL, 'HABITACION SUITE ESTANDAR', 2, 0, 0, 50);
INSERT INTO DORMITORIOS VALUES (NULL, 'HABITACION SUITE MATRIMONIO', 0, 1, 0, 50);
INSERT INTO DORMITORIOS VALUES (NULL, 'HABITACION SUITE FAMILIAR', 0, 1, 2, 70);


-- TABLA ALOJAMIENTO_DORMITORIO --

INSERT INTO ALOJAMIENTO_DORMITORIO VALUES (1, 1, 1);
INSERT INTO ALOJAMIENTO_DORMITORIO VALUES (1, 2, 1);
INSERT INTO ALOJAMIENTO_DORMITORIO VALUES (1, 3, 10);
INSERT INTO ALOJAMIENTO_DORMITORIO VALUES (2, 2, 10);
INSERT INTO ALOJAMIENTO_DORMITORIO VALUES (2, 4, 10);
INSERT INTO ALOJAMIENTO_DORMITORIO VALUES (3, 1, 10);
INSERT INTO ALOJAMIENTO_DORMITORIO VALUES (3, 5, 10);
INSERT INTO ALOJAMIENTO_DORMITORIO VALUES (3, 6, 10);
INSERT INTO ALOJAMIENTO_DORMITORIO VALUES (4, 2, 10);
INSERT INTO ALOJAMIENTO_DORMITORIO VALUES (5, 2, 10);
INSERT INTO ALOJAMIENTO_DORMITORIO VALUES (6, 2, 10);
INSERT INTO ALOJAMIENTO_DORMITORIO VALUES (7, 2, 10);
INSERT INTO ALOJAMIENTO_DORMITORIO VALUES (8, 2, 10);
INSERT INTO ALOJAMIENTO_DORMITORIO VALUES (9, 2, 10);
INSERT INTO ALOJAMIENTO_DORMITORIO VALUES (10, 2, 10);


-- TABLA RESERVAS --

INSERT INTO RESERVAS VALUES (NULL, 1, 1, '2019-04-14', '2019-04-17', '2019-04-20', 300);
INSERT INTO RESERVAS VALUES (NULL, 2, 1, '2019-04-14', '2019-04-17', '2019-04-20', 200);


-- TABLA RESERVA_DORMITORIO --

INSERT INTO RESERVA_DORMITORIO VALUES (1, 1, 1);
INSERT INTO RESERVA_DORMITORIO VALUES (2, 2, 1);
